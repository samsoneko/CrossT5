EU leaders and Turkey have agreed a comprehensive plan that opens a safe and legal route to the EU for Syrian refugees while reducing irregular migration.